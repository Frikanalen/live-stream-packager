{{- if .Values.cubemap.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "live-stream-packager.fullname" . }}-cubemap
  labels:
    {{- include "live-stream-packager.labels" . | nindent 4 }}
    app.kubernetes.io/component: cubemap
data:
  cubemap.config: |
    num_servers 1
    port {{ .Values.cubemap.httpPort }}
    error_log type=console

    # Health check endpoint
    gen204 /health

    # UDP input - receives MPEG-TS from external source
    # Serves via HTTP for ffmpeg to consume (allows reconnection during rollouts)
    stream /stream.ts src=udp://@:{{ .Values.cubemap.udpPort }}
{{- end }}
