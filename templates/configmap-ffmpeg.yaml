apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "live-stream-packager.fullname" . }}-ffmpeg
  labels:
    {{- include "live-stream-packager.labels" . | nindent 4 }}
    app.kubernetes.io/component: transcoder
data:
  ffmpegOptions: {{ .Values.ffmpeg.ffmpegOptions | quote }}
  {{- if .Values.cubemap.enabled }}
  # Read from Cubemap HTTP endpoint (allows graceful reconnection during rollouts)
  inputSourceUrl: {{ printf "http://%s-cubemap:%d/stream.ts" (include "live-stream-packager.fullname" .) (int .Values.cubemap.httpPort) | quote }}
  {{- else }}
  inputSourceUrl: {{ .Values.ffmpeg.inputSourceUrl | quote }}
  {{- end }}
  encodingOptions: |
{{ .Values.ffmpeg.encodingOptions | indent 4 }}
